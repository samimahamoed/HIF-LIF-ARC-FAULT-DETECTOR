\hypertarget{a00047_source}{\section{light\+\_\+sensor.\+c}
\label{a00047_source}\index{light\+\_\+sensor.\+c@{light\+\_\+sensor.\+c}}
}

\begin{DoxyCode}
00001 
00009 \textcolor{preprocessor}{#include "..\(\backslash\)..\(\backslash\)includes\(\backslash\)allheaders.h"} 
00010 \textcolor{preprocessor}{#include "..\(\backslash\)..\(\backslash\)includes\_prv\(\backslash\)aq0X\(\backslash\)light\_sensor\_prv.h"}
00011 
00012 
\hypertarget{a00047_source_l00014}{}\hyperlink{a00047_a53c98c9f84d5cecf0747bbe1f6b83696}{00014} \hyperlink{a00024_d8/d2e/a00588}{light\_sen\_data\_t} \hyperlink{a00047_a53c98c9f84d5cecf0747bbe1f6b83696}{light\_sen\_data};
\hypertarget{a00047_source_l00015}{}\hyperlink{a00047_a757e7771170ace1d9f8519bd318ec64a}{00015} \hyperlink{a00036_ad5c3c5fbfd3e4aadf22830395484a71d}{x\_task\_id}        \hyperlink{a00047_a757e7771170ace1d9f8519bd318ec64a}{light\_sen\_id};
00016 
00017 
00018 
00026 \textcolor{keyword}{static} \textcolor{keywordtype}{void} light\_sen\_init(\textcolor{keywordtype}{void})
00027 \{
00028 
00029 
00030     memset(&light\_sen\_data,0,\textcolor{keyword}{sizeof}(light\_sen\_data));
00031 
00032     \textcolor{comment}{// Prepare notifications and events to be used later on}
00033 
00034     light\_sen\_data.\hyperlink{a00024_ada91b200053f2d93e3639dc4ee3415b4}{sv\_timer\_ntf}.\hyperlink{a00036_adf9665938515a20c283eea2c978cf80d}{message}                                  = 
      \hyperlink{a00024_ad7dfa3ed8d8d926ba462f9e951f1b391}{X\_NTF\_LIGHT\_SENSOR\_SV\_TIMER} ;
00035     light\_sen\_data.\hyperlink{a00024_ada91b200053f2d93e3639dc4ee3415b4}{sv\_timer\_ntf}.\hyperlink{a00036_a21b41e494a28583d4da10f1afb1c5328}{task\_id}                           = 
      \hyperlink{a00047_a757e7771170ace1d9f8519bd318ec64a}{light\_sen\_id};
00036 
00037 
00038     light\_sen\_data.\hyperlink{a00024_a43c345f39ea3aefbb60ef1ef57fe5d83}{sv\_task\_event}.\hyperlink{a00036_adf9665938515a20c283eea2c978cf80d}{message}                     = 
      \hyperlink{a00024_a5877f449ae4b7e77914fedf212c3d01f}{X\_MSG\_LIGHT\_SENSOR\_SV};
00039     light\_sen\_data.\hyperlink{a00024_a43c345f39ea3aefbb60ef1ef57fe5d83}{sv\_task\_event}.\hyperlink{a00036_a21b41e494a28583d4da10f1afb1c5328}{task\_id}                 = 
      \hyperlink{a00047_a757e7771170ace1d9f8519bd318ec64a}{light\_sen\_id};
00040 
00041     \textcolor{comment}{// Notifications and events sent to Algorithm module}
00042     light\_sen\_data.\hyperlink{a00024_a35ce77844e6990e2537b2f11cd2d5cca}{sv\_status\_ntf}.\hyperlink{a00018_a8e6a04c2283f9fd7b8dcbc62faba5847}{notify}.\hyperlink{a00036_adf9665938515a20c283eea2c978cf80d}{message}                    = 
      \hyperlink{a00021_a472c0187f61238cdef62bf3d965df8e2}{X\_NTF\_LIGHT\_SENSOR\_SV\_ALART};
00043     light\_sen\_data.\hyperlink{a00024_a35ce77844e6990e2537b2f11cd2d5cca}{sv\_status\_ntf}.\hyperlink{a00018_a8e6a04c2283f9fd7b8dcbc62faba5847}{notify}.\hyperlink{a00036_a21b41e494a28583d4da10f1afb1c5328}{task\_id}                = 
      \hyperlink{a00021_aff3e3d622fcd96787628167d3c1856f9}{algorithm\_id};
00044 
00045 
00046 
00047 
00048 
00049     \textcolor{comment}{// Schedule timer for periodic supervison scan}
00050     \hyperlink{a00036_a9e3befaa21e83f196f74201deed85346}{x\_schedule\_timer}(&light\_sen\_data.\hyperlink{a00024_ada91b200053f2d93e3639dc4ee3415b4}{sv\_timer\_ntf},
      \hyperlink{a00036_a1732cd929c486b3a225824bb2b3dba36}{X\_MS2TICK}(\hyperlink{a00023_a8a535456285f4602701c814d7b69cc68}{SV\_TIMER\_PERIOD}));
00051 \}
00052 
00053 
00054 
00055 
00056 
\hypertarget{a00047_source_l00065}{}\hyperlink{a00047_ae9aa2f8b8e90a92755efbcd161c67bc0}{00065} \textcolor{keywordtype}{void} \hyperlink{a00047_ae9aa2f8b8e90a92755efbcd161c67bc0}{light\_sen\_taskx}(\hyperlink{a00036_de/d37/a00849}{x\_event} *event)
00066 \{
00067     \textcolor{keywordflow}{switch}(event->\hyperlink{a00036_adf9665938515a20c283eea2c978cf80d}{message})
00068     \{
00069 
00070     
00071         \textcolor{keywordflow}{case} \hyperlink{a00024_a5877f449ae4b7e77914fedf212c3d01f}{X\_MSG\_LIGHT\_SENSOR\_SV}:
00072         \{
00073 
00074             \hyperlink{a00047_ae68a20cad10654012eae75a1941f53db}{light\_sen\_sensor\_element\_sv\_task}();
00075 
00076             \hyperlink{a00047_a05bd338db50fc948cf13db4f250894da}{light\_sen\_false\_positive\_adjustment\_task}();
00077 
00078             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_a1caa87b00c878186140c3bac9c8acf3b}{flags\_all}!=0)\{
00079              light\_sen\_data.\hyperlink{a00024_a35ce77844e6990e2537b2f11cd2d5cca}{sv\_status\_ntf}.\hyperlink{a00018_a18ed963ee616596e9d500e042f228818}{message}.error\_status\_flags.flags\_all = 
      light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_a1caa87b00c878186140c3bac9c8acf3b}{flags\_all};
00080              \textcolor{comment}{// Send notification to Algorithm module about detected error}
00081              \hyperlink{a00036_ae17b0bb16da3c471bb6074bb4c4d0fee}{x\_send\_notify}(&light\_sen\_data.\hyperlink{a00024_a35ce77844e6990e2537b2f11cd2d5cca}{sv\_status\_ntf}.
      \hyperlink{a00018_a8e6a04c2283f9fd7b8dcbc62faba5847}{notify});
00082              light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_a1caa87b00c878186140c3bac9c8acf3b}{flags\_all} =0;
00083             \}
00084             
00085         \}\textcolor{keywordflow}{break};
00086       
00087 
00088         
00089         \textcolor{keywordflow}{default}:
00090         \{
00091             \hyperlink{a00072_abb8ff8e213ac9f6fb21d2b968583b936}{ASSERT}(0);
00092         \}        
00093     \}
00094 \}
00095 
00096 
00097 
\hypertarget{a00047_source_l00106}{}\hyperlink{a00047_a317b03892739257278fd51ab8003962d}{00106} \textcolor{keywordtype}{void} \hyperlink{a00047_a317b03892739257278fd51ab8003962d}{light\_sen\_notifyx}(\hyperlink{a00036_df/d4c/a00851}{x\_notify} *notify)
00107 \{
00108 
00109     
00110     \textcolor{keywordflow}{switch}(notify->\hyperlink{a00036_adf9665938515a20c283eea2c978cf80d}{message})
00111     \{    
00112         \textcolor{keywordflow}{case} \hyperlink{a00036_a620b808f2d7b8d2a03c4d026a4c5423c}{X\_NTF\_INIT}:
00113         \{
00114             light\_sen\_init();
00115         \}\textcolor{keywordflow}{break};
00116 
00117 
00118         \textcolor{keywordflow}{case} \hyperlink{a00018_ac8c3accc8173c965137b300542e451e6}{X\_NTF\_LIGHT\_SENSOR\_CONFIG}:
00119         \{
00120 
00121             \textcolor{comment}{// configuration details from algorithm module}
00122             \hyperlink{a00018_da/de3/a00856}{x\_notify\_light\_sen\_configure} * notify\_configure = (
      \hyperlink{a00018_da/de3/a00856}{x\_notify\_light\_sen\_configure} *)notify;
00123 
00124            
00125             light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured} = notify\_configure->\hyperlink{a00018_a32952acc732e2f16aad59fe0804da5bf}{message}.configured;
00126             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record} = notify\_configure->
      \hyperlink{a00018_a32952acc732e2f16aad59fe0804da5bf}{message}.disturbance\_record;
00127 
00128             \textcolor{comment}{// Clear supervison state ( so errors will be reported if module have internal error )}
00129              light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_a1caa87b00c878186140c3bac9c8acf3b}{flags\_all} = 0;
00130 
00131           \hyperlink{a00036_ab69e9af4cfa717e870d587906283635c}{x\_delete\_timer}(&light\_sen\_data.\hyperlink{a00024_ada91b200053f2d93e3639dc4ee3415b4}{sv\_timer\_ntf});
00132 
00133           \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_afeb3f74725269028a60926f98890c22b}{element\_status\_sv\_en})
00134           \hyperlink{a00036_a9e3befaa21e83f196f74201deed85346}{x\_schedule\_timer}(&light\_sen\_data.\hyperlink{a00024_ada91b200053f2d93e3639dc4ee3415b4}{sv\_timer\_ntf},
      \hyperlink{a00036_a1732cd929c486b3a225824bb2b3dba36}{X\_MS2TICK}(\hyperlink{a00023_a8a535456285f4602701c814d7b69cc68}{SV\_TIMER\_PERIOD}));
00135 
00136         \}\textcolor{keywordflow}{break};
00137 
00138 
00139          \textcolor{keywordflow}{case} X\_NTF\_CLR\_ALARM:
00140         \{
00141 
00142            \textcolor{comment}{// Algorithm module alarm reset request}
00143              light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = 
      \hyperlink{a00021_ad6739dbbe5581cac99b7dc8a5e09949c}{STATE\_0};
00144              \hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{light\_sen\_mark\_false\_postives}();
00145 
00146 
00147         \}\textcolor{keywordflow}{break};
00148 
00149         
00150         \textcolor{keywordflow}{case} \hyperlink{a00024_ad7dfa3ed8d8d926ba462f9e951f1b391}{X\_NTF\_LIGHT\_SENSOR\_SV\_TIMER}:
00151         \{
00152            \hyperlink{a00036_a4bc3d03c8d62c8237329ed4e969fbc1b}{x\_send\_event}(&light\_sen\_data.\hyperlink{a00024_a43c345f39ea3aefbb60ef1ef57fe5d83}{sv\_task\_event});
00153         \}\textcolor{keywordflow}{break};
00154         
00155        
00156         \textcolor{keywordflow}{default}:
00157         \{
00158             \hyperlink{a00072_abb8ff8e213ac9f6fb21d2b968583b936}{ASSERT}(0);
00159         \}
00160     \}
00161 
00162 \}
00163 
00164 
\hypertarget{a00047_source_l00172}{}\hyperlink{a00047_a4c8812458e0a70eaa4be14a7ca5dc9b7}{00172} \hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32} \hyperlink{a00047_a4c8812458e0a70eaa4be14a7ca5dc9b7}{light\_sen\_first\_order\_derivative}(
      \hyperlink{a00072_a59a9f6be4562c327cbfb4f7e8e18f08b}{Uint16} final\_val,\hyperlink{a00072_a59a9f6be4562c327cbfb4f7e8e18f08b}{Uint16} init\_val,\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32} period)\{
00173     \textcolor{keywordflow}{return} (\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32})(final\_val-init\_val)/period;
00174 \}
00175 
00176 
\hypertarget{a00047_source_l00184}{}\hyperlink{a00047_acfaee257a4ad46d9d0ffb57f97d8f35f}{00184} \hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32} \hyperlink{a00047_acfaee257a4ad46d9d0ffb57f97d8f35f}{light\_sen\_calc\_probablity}(\textcolor{keywordtype}{void})\{
00185 
00186     \textcolor{keywordflow}{return} (\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32})light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt}
00187             /
00188            (\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32})light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt};
00189 
00190 \}
00191 
00192 
00193 
\hypertarget{a00047_source_l00204}{}\hyperlink{a00047_a8ae9d26a7404094bcd7cbef5ed40da75}{00204} \hyperlink{a00021_d6/d66/a00441}{event\_report\_t} \hyperlink{a00047_a8ae9d26a7404094bcd7cbef5ed40da75}{light\_sen\_get\_status}(\hyperlink{a00072_a59a9f6be4562c327cbfb4f7e8e18f08b}{Uint16} adc\_value,
      \hyperlink{a00072_a253b248072cfc8bd812c69acd0046eed}{Bool} save\_event)
00205 \{
00206 
00207     \hyperlink{a00021_d6/d66/a00441}{event\_report\_t} status;
00208     status.\hyperlink{a00021_a5296d090c085b0421fdf5a86e382abea}{fields}.active\_signal= \hyperlink{a00040_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
00209 
00210     light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_a0fc6d9ce6203a17f672c19d3d8747aee}{previous} = light\_sen\_data.
      \hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current};
00211 
00212     light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level} = adc\_value;
00213 
00214     light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time} = 
      \hyperlink{a00047_a4c8812458e0a70eaa4be14a7ca5dc9b7}{light\_sen\_first\_order\_derivative}(
00215                                             light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.
      \hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level},
00216                                             light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.
      \hyperlink{a00017_a0fc6d9ce6203a17f672c19d3d8747aee}{previous}.\hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level},
00217                                             \hyperlink{a00021_a3a4dcb8af26a561d90607a41a3745806}{FAST\_TIMER\_SAMPLING\_RATE}
00218                                             );
00219 
00220 
00221     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time} > 0)
00222         status.\hyperlink{a00021_a5296d090c085b0421fdf5a86e382abea}{fields}.active\_signal = \hyperlink{a00040_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
00223 
00224  
00225     \textcolor{keywordflow}{if}(\hyperlink{a00021_a2e89c46668b39a17753c238950c9e1ec}{logv}.\hyperlink{a00021_a32ebd32977bc9831cd68530b2b7ec664}{trip\_active} == \hyperlink{a00040_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE})\{
00226     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a9c699c0cc82d0baa6e49195f185ab34f}{post\_act\_data}.head <
00227         ((\hyperlink{a00060_a76ac5f917f5308dcd83de0d7c94559fb}{data\_non\_volatile}.disturbance\_record.light.emu\_data\_en==
      \hyperlink{a00040_aa93f0eb578d23995850d61f7d61c55c1}{FALSE})?\hyperlink{a00022_ab1ad440de86fff80e517ad748de2ee39}{POST\_ACT\_RECORD\_BUFF\_SIZE}:(
      \hyperlink{a00022_ab1ad440de86fff80e517ad748de2ee39}{POST\_ACT\_RECORD\_BUFF\_SIZE}-\hyperlink{a00022_af4c3a8ad94feb4d7bda7f107f34baf41}{EMU\_MODE\_DATA\_LENGTH})))
00228       light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a9c699c0cc82d0baa6e49195f185ab34f}{post\_act\_data}.buffer.all[
      light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a9c699c0cc82d0baa6e49195f185ab34f}{post\_act\_data}.head++] = adc\_value;
00229     \}\textcolor{keywordflow}{else}\{
00231     light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_ad611012074e252bf84c1cfb8c273dd79}{buffer}[light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_a15a6827ccabba1c22396eccc1c5c654b}{head}] = adc\_value;
00232     light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_a15a6827ccabba1c22396eccc1c5c654b}{head}
00233             = (light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_a15a6827ccabba1c22396eccc1c5c654b}{head} + 1)%\hyperlink{a00022_a18dcecc16ded13fa622e0913e73442e6}{PRE\_ACT\_RECORD\_BUFF\_SIZE};
00234 
00235     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_abecaedb3605e8bca8335cd81ca63025f}{elapsed} == \hyperlink{a00040_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE})
00236     light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_ab3bcc08acd9d73ce1a44992255658e37}{tail}
00237             = (light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_a15a6827ccabba1c22396eccc1c5c654b}{head} + 1)%\hyperlink{a00022_a18dcecc16ded13fa622e0913e73442e6}{PRE\_ACT\_RECORD\_BUFF\_SIZE};
00238     \textcolor{keywordflow}{else}
00239     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_a15a6827ccabba1c22396eccc1c5c654b}{head} == \hyperlink{a00022_a18dcecc16ded13fa622e0913e73442e6}{PRE\_ACT\_RECORD\_BUFF\_SIZE} - 1)
00240     light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_aab01e8da056827bc5c9caff9b64c78be}{pre\_act\_data}.
      \hyperlink{a00022_abecaedb3605e8bca8335cd81ca63025f}{elapsed} = \hyperlink{a00040_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
00241     \}
00242 
00243     light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold.all = 0;
00244     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time} > 
      light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_adf9a37828e447378b1d533185213316d}{dfdt\_treshold\_max})
00245         light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold.bits.
      dfdt\_max = 1;
00246     \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level} > light\_sen\_data.
      \hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.amp\_treshold\_max)
00247         light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold.bits.
      amp\_max = 1;
00248 
00249 
00250 
00251 
00252 
00253 
00254  
00255     \textcolor{keywordflow}{switch}(light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state})
00256     \{
00257         \textcolor{keywordflow}{case} \hyperlink{a00021_ad6739dbbe5581cac99b7dc8a5e09949c}{STATE\_0}:
00258         \{
00259             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .all !=0)\{
00260               light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_history    = 
      0;
00261 
00262             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}    = 1;
00263             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt} = 1;
00264 
00265             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.signal\_level[0
      ] = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level};
00266             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.
      change\_per\_time[0] = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time};
00267             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr++;
00268 
00269             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.timestamp = 
      \hyperlink{a00021_a2e89c46668b39a17753c238950c9e1ec}{logv}.\hyperlink{a00021_a81f0ce68c2c483fb8df726cc1988d8e8}{tick};
00270             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability = 
      \hyperlink{a00047_acfaee257a4ad46d9d0ffb57f97d8f35f}{light\_sen\_calc\_probablity}();
00271 
00272             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .bits.amp\_max)\{
00273                 light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = 
      \hyperlink{a00021_a66fa48e832a64af4d405511cecc4c752}{STATE\_2};
00274             \}\textcolor{keywordflow}{else}\{
00275               light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = 
      \hyperlink{a00021_a727351838367f27ac0adb9a13422c342}{STATE\_1};
00276               light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_history++;
00277             \}
00278             \}
00279 
00280 
00281         \}\textcolor{keywordflow}{break};
00282 
00283          \textcolor{keywordflow}{case} \hyperlink{a00021_a727351838367f27ac0adb9a13422c342}{STATE\_1}:
00284         \{
00285 
00286              light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}++;
00287 
00288             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr < 
      EVENT\_OBSERVATION\_RECORD\_LENGTH)\{
00289             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.signal\_level[
      light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00290                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level};
00291             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.
      change\_per\_time[light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00292                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time};
00293             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr++;
00294             \}
00295 
00296             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .all!=0)
00298                  light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt}++;
00299 
00300             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability = 
      \hyperlink{a00047_acfaee257a4ad46d9d0ffb57f97d8f35f}{light\_sen\_calc\_probablity}();
00301 
00302             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .bits.amp\_max)\{
00303                 light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = 
      \hyperlink{a00021_a66fa48e832a64af4d405511cecc4c752}{STATE\_2};
00304             \}\textcolor{keywordflow}{else}
00305                  light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_history++;
00306 
00307        
00308             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}
00309                 >=
00310                 light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_ae8665e8bf422c1482442d6949ba28408}{min\_number\_of\_observation}
00311                )\{
00312                
00313                    \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability
00314                     >
00315                     light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_a7e2d217b9c9051d361319180a426851c}{probablity\_treshold\_max}
00316                     )\{
00317                          light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = \hyperlink{a00021_a1eb14cc432874ddacd1934791dbe12a3}{HOT};
00318                          light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a9c699c0cc82d0baa6e49195f185ab34f}{post\_act\_data}.head=0;
00319                      \}\textcolor{keywordflow}{else}\{
00320                          light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = \hyperlink{a00021_ad6739dbbe5581cac99b7dc8a5e09949c}{STATE\_0};
00321                          \hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{light\_sen\_mark\_false\_postives}();
00322                     \}
00323              \}
00324              
00325         \}\textcolor{keywordflow}{break};
00326 
00327           \textcolor{keywordflow}{case} \hyperlink{a00021_a66fa48e832a64af4d405511cecc4c752}{STATE\_2}:
00328         \{
00329             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}++;
00330             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .bits.amp\_max)
00331                 light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt}++;
00332 
00333 
00334             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr < 
      EVENT\_OBSERVATION\_RECORD\_LENGTH)\{
00335             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.signal\_level[
      light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00336                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level};
00337             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.
      change\_per\_time[light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00338                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time};
00339             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr++;
00340             \}
00341 
00342               \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}
00343                 >=
00344                 light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_ae8665e8bf422c1482442d6949ba28408}{min\_number\_of\_observation}
00345                )\{
00346 
00347                    \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability
00348                     >
00349                     light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_a7e2d217b9c9051d361319180a426851c}{probablity\_treshold\_max}
00350                     )\{
00351                          light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = \hyperlink{a00021_a1eb14cc432874ddacd1934791dbe12a3}{HOT};
00352                          light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a9c699c0cc82d0baa6e49195f185ab34f}{post\_act\_data}.head=0;
00353                      \}\textcolor{keywordflow}{else}\{
00354                          light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = \hyperlink{a00021_ad6739dbbe5581cac99b7dc8a5e09949c}{STATE\_0};
00355                          \hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{light\_sen\_mark\_false\_postives}();
00356                     \}
00357              \}
00358 
00359 
00360          \}\textcolor{keywordflow}{break};
00361 
00362 
00363 
00364          \textcolor{keywordflow}{case} \hyperlink{a00021_a1eb14cc432874ddacd1934791dbe12a3}{HOT}:
00365         \{
00366 
00367              light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}++;
00368 
00369             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr < 
      EVENT\_OBSERVATION\_RECORD\_LENGTH)\{
00370             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.signal\_level[
      light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00371                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_abcdf2bc0c2e5a14863938ae28c3bc96e}{signal\_level};
00372             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.
      change\_per\_time[light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr]
00373                     = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_ad5c4f9a39d2a36632a53205ae8eb5a5d}{change\_per\_time};
00374             light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.head\_ptr++;
00375             \}
00376 
00377             \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.exceeded\_threshold
      .all != 0)
00378                 light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt}++;
00379             
00380 
00381              light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability = 
      \hyperlink{a00047_acfaee257a4ad46d9d0ffb57f97d8f35f}{light\_sen\_calc\_probablity}();
00382 
00383 
00384 
00385              \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_probability
       < light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_aa59261f74183d4f9e909ac425e0bea35}{probablity\_treshold\_min})\{
00386                  light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.\hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state} = 
      \hyperlink{a00021_ad6739dbbe5581cac99b7dc8a5e09949c}{STATE\_0};
00387                  \hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{light\_sen\_mark\_false\_postives}();
00388 
00389              \}
00390 
00391              \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt} > \hyperlink{a00021_ae01726ef8ba0a9e1fe8655dc382ecda8}{RANGE\_MAX\_16BIT} - 1
00392                 ||
00393                 light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt} > \hyperlink{a00021_ae01726ef8ba0a9e1fe8655dc382ecda8}{RANGE\_MAX\_16BIT} - 1
00394                 )\{
00395              \textcolor{comment}{//Prevents overflow}
00396               light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_ad5b0bac02ce266b91b2b52a1c3ea1d78}{observation\_cnt}    /=10;
00397               light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a7397b9d76d4b57500f27bb23d258a18a}{event\_positive\_cnt} /=10;
00398              \}
00399 
00400         \}\textcolor{keywordflow}{break};
00401 
00402 
00403 
00404 
00405         \textcolor{keywordflow}{default}:
00406         \{
00407             \hyperlink{a00072_abb8ff8e213ac9f6fb21d2b968583b936}{ASSERT}(0);
00408         \}
00409     \}
00410 
00411   status.\hyperlink{a00021_a5296d090c085b0421fdf5a86e382abea}{fields}.state = light\_sen\_data.\hyperlink{a00024_a5a53c391562b059eb744ac679f3765ca}{module\_status}.\hyperlink{a00017_ab8af48cdbba92b3ae39c4470e53af944}{current}.
      \hyperlink{a00017_a6b8d8e916bc56265a3fd279bd26b6d1b}{state};
00412 
00413   \textcolor{keywordflow}{return} status;
00414 
00415 \}
00416 
00417 
00418 
\hypertarget{a00047_source_l00426}{}\hyperlink{a00047_ae68a20cad10654012eae75a1941f53db}{00426} \textcolor{keywordtype}{void} \hyperlink{a00047_ae68a20cad10654012eae75a1941f53db}{light\_sen\_sensor\_element\_sv\_task}(\textcolor{keywordtype}{void})
00427 \{
00428 
00429 
00430 
00431 
00432 \}
00433 
\hypertarget{a00047_source_l00441}{}\hyperlink{a00047_a05bd338db50fc948cf13db4f250894da}{00441} \textcolor{keywordtype}{void} \hyperlink{a00047_a05bd338db50fc948cf13db4f250894da}{light\_sen\_false\_positive\_adjustment\_task}(\textcolor{keywordtype}{void})\{
00442 
00443 
00444     \textcolor{keywordflow}{if}(
00445      (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.cnt < 
      \hyperlink{a00024_aa88a423475bb5b13601785eed80fb1b9}{FALSE\_POSITIVE\_TOLERANCE\_LIMIT})
00446           &&
00447      (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.cnt < 
      \hyperlink{a00024_aa88a423475bb5b13601785eed80fb1b9}{FALSE\_POSITIVE\_TOLERANCE\_LIMIT})
00448      )\{
00449       light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_ab81eb6fb4f1351ed07b4d6c4dd6f1959}{bits}.FALSE\_POSITIVE\_AMP\_TH  = 0;
00450       light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_ab81eb6fb4f1351ed07b4d6c4dd6f1959}{bits}.FALSE\_POSITIVE\_DFDT\_TH = 0;
00451       memset(&light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm},0,\textcolor{keyword}{sizeof}(
      light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}));
00452       \textcolor{keywordflow}{return};
00453 
00454     \}
00455 
00456       \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.cnt > 
      \hyperlink{a00024_aa88a423475bb5b13601785eed80fb1b9}{FALSE\_POSITIVE\_TOLERANCE\_LIMIT})\{
00457           light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_ab81eb6fb4f1351ed07b4d6c4dd6f1959}{bits}.FALSE\_POSITIVE\_DFDT\_TH = 1;
00458 
00459          \textcolor{keywordflow}{if}(!light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_a18e270a10094f045f20299b0f7e83085}{threshold\_adjust\_manual})
00460           \textcolor{comment}{//TODO: varifiy this will correct the problem}
00461           light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.\hyperlink{a00021_adf9a37828e447378b1d533185213316d}{dfdt\_treshold\_max} +=
00462           light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.
      recorded\_avg +
00463           light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.
      recorded\_avg*0.01;
00464 
00465       \}
00466 
00467 
00468       \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.cnt > 
      \hyperlink{a00024_aa88a423475bb5b13601785eed80fb1b9}{FALSE\_POSITIVE\_TOLERANCE\_LIMIT})\{
00469           light\_sen\_data.\hyperlink{a00024_aaeec6b0609dba31393f337abf1cce3d3}{sv\_errors\_flags}.\hyperlink{a00022_ab81eb6fb4f1351ed07b4d6c4dd6f1959}{bits}.FALSE\_POSITIVE\_AMP\_TH = 1;
00470           light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.amp\_treshold\_max +=
00471           light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.
      recorded\_avg +
00472           light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.
      recorded\_avg*0.001;
00473 
00474            memset(&light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm},0,\textcolor{keyword}{sizeof}(light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}));
00475       \}
00476 
00477 
00479 
00480 
00481 
00482 \}
00483 
00484 
\hypertarget{a00047_source_l00491}{}\hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{00491} \textcolor{keywordtype}{void} \hyperlink{a00047_acef1622ec5c40fe90bf6184813716e34}{light\_sen\_mark\_false\_postives}(\textcolor{keywordtype}{void})\{
00492         \textcolor{keywordflow}{if}(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->\hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.event\_history == 
      \hyperlink{a00019_a9c5372190518a7d696da393f1a9a5fb9}{EXCEDED\_AMP\_TH})\{
00493                \textcolor{keywordflow}{if}(
00494                 (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded
      .cnt < \hyperlink{a00021_ae0c75a1cb44e5d3f00ec7c9e40acfda8}{RANGE\_MAX\_8BIT})
00495                 &
00496                 (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded
      .accumulated\_value < \hyperlink{a00021_a334bd006b6d2b397dbfc620d62c3c35c}{RANGE\_MAX\_32BIT})
00497                )
00498                \{
00499                      light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.cnt++;
00500                      light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.accumulated\_value
00501                      +=(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.signal\_level[0]-light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.amp\_treshold\_max);
00502                      light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.recorded\_avg
00503                      = light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.accumulated\_value/
00504                              (\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32})light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.amp\_max\_exceded.cnt;
00505               \}
00506 
00507              \}\textcolor{keywordflow}{else}\{
00508              \textcolor{keywordflow}{if}(
00509                 (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.
      dfdt\_max\_exceded.cnt < \hyperlink{a00021_ae0c75a1cb44e5d3f00ec7c9e40acfda8}{RANGE\_MAX\_8BIT})
00510                 &
00511                 (light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.
      dfdt\_max\_exceded.accumulated\_value < \hyperlink{a00021_a334bd006b6d2b397dbfc620d62c3c35c}{RANGE\_MAX\_32BIT})
00512                )
00513              \{
00514 
00515                  light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.
      dfdt\_max\_exceded.cnt++;
00516                  light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.
      dfdt\_max\_exceded.accumulated\_value
00517                  +=(light\_sen\_data.\hyperlink{a00024_ac9b38e2c1d3f1013a88d33506c754152}{disturbance\_record}->
      \hyperlink{a00028_a8c0bda69e71ef674e60da47ad0be9ab0}{event\_data}.buffer.change\_per\_time[0]-light\_sen\_data.\hyperlink{a00024_a94b2d1f6ea4ab334c74d24984dd27843}{configured}.
      \hyperlink{a00021_adf9a37828e447378b1d533185213316d}{dfdt\_treshold\_max});
00518                  light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.\hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.
      dfdt\_max\_exceded.recorded\_avg
00519                  = light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.accumulated\_value/
00520                     (\hyperlink{a00072_a87d38f886e617ced2698fc55afa07637}{Float32})light\_sen\_data.\hyperlink{a00024_a7ae905b560513ad201e58c2f63375030}{diagonesis\_records}.
      \hyperlink{a00017_a799f50625c0c03f9404a59287810113d}{false\_alarm}.dfdt\_max\_exceded.cnt;
00521 
00522              \}
00523 
00524              \}
00525 
00526 \}
\end{DoxyCode}
