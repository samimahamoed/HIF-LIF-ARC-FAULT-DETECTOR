\hypertarget{a00048}{\section{main.\+c File Reference}
\label{a00048}\index{main.\+c@{main.\+c}}
}


Low-\/level startup , calls O\+S initalization.  


{\ttfamily \#include \char`\"{}..\textbackslash{}includes\textbackslash{}allheaders.\+h\char`\"{}}\\*
Include dependency graph for main.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/dce/a00944}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{a00048_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\begin{DoxyCompactList}\small\item\em System startup function. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{a00033_d3/d95/a00779}{sqtp\+\_\+t} \hyperlink{a00048_a4e1e8b365cce7a6d497671681eb5823c}{sqtp\+\_\+info}
\begin{DoxyCompactList}\small\item\em Oscilator setting Run this project using an internal F\+R\+C. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Low-\/level startup , calls O\+S initalization. 



Definition in file \hyperlink{a00048_source}{main.\+c}.



\subsection{Function Documentation}
\hypertarget{a00048_a840291bc02cba5474a4cb46a9b9566fe}{\index{main.\+c@{main.\+c}!main@{main}}
\index{main@{main}!main.\+c@{main.\+c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{a00048_a840291bc02cba5474a4cb46a9b9566fe}


System startup function. 

Configures operating system and basic system independent services Configure Oscillator to operate the device at 60\+M\+I\+P\+S Fpll\+\_\+out= Fin$\ast$\+M/(N1$\ast$\+N2)=Fin$\ast$(P\+L\+L\+D\+I\+V+2)/((P\+L\+L\+P\+R\+E+2)+(P\+L\+L\+P\+O\+S\+T+1)), Fcy=Fosc/2 Fvco = Fin$\ast$\+M/\+N1 = Fin$\ast$(P\+L\+L\+D\+I\+V+2)/(P\+L\+L\+P\+R\+E+2) Fpll\+\_\+out = 7.\+37\+M$\ast$65/(2$\ast$3) = 80\+Mhz for 7.\+37\+M\+Hz F\+R\+C input clock

Init watchdog. Initial kick.

Watchdog kick -\/ before O\+S starts

Definition at line \hyperlink{a00048_source_l00080}{80} of file \hyperlink{a00048_source}{main.\+c}.



References \hyperlink{a00038_source_l00034}{algorithm\+\_\+id}, \hyperlink{a00038_source_l02006}{algorithm\+\_\+notifyx()}, \hyperlink{a00038_source_l01905}{algorithm\+\_\+taskx()}, \hyperlink{a00060_source_l00016}{data\+\_\+non\+\_\+volatile}, \hyperlink{a00056_source_l00041}{hwio\+\_\+configure\+\_\+init()}, \hyperlink{a00056_source_l00272}{hwio\+\_\+execute\+\_\+gpio\+\_\+task()}, \hyperlink{a00056_source_l00223}{hwio\+\_\+get\+\_\+analog()}, \hyperlink{a00058_source_l00041}{H\+W\+I\+O\+\_\+\+S\+V\+\_\+\+L\+E\+D\+\_\+\+O\+F\+F}, \hyperlink{a00058_source_l00040}{H\+W\+I\+O\+\_\+\+S\+V\+\_\+\+L\+E\+D\+\_\+\+O\+N}, \hyperlink{a00045_source_l00023}{ir\+\_\+sen\+\_\+id}, \hyperlink{a00045_source_l00141}{ir\+\_\+sen\+\_\+notifyx()}, \hyperlink{a00045_source_l00069}{ir\+\_\+sen\+\_\+taskx()}, \hyperlink{a00047_source_l00015}{light\+\_\+sen\+\_\+id}, \hyperlink{a00047_source_l00106}{light\+\_\+sen\+\_\+notifyx()}, \hyperlink{a00047_source_l00065}{light\+\_\+sen\+\_\+taskx()}, \hyperlink{a00050_source_l00024}{mfield\+\_\+x\+\_\+sen\+\_\+id}, \hyperlink{a00050_source_l00107}{mfield\+\_\+x\+\_\+sen\+\_\+notifyx()}, \hyperlink{a00050_source_l00071}{mfield\+\_\+x\+\_\+sen\+\_\+taskx()}, \hyperlink{a00019_a99c4ad3cf8b9ce2b67351d6edf48f937}{mfield\+\_\+y\+\_\+sen\+\_\+id}, \hyperlink{a00019_a80b82366f7d22e925f279d20328f05c8}{mfield\+\_\+y\+\_\+sen\+\_\+notifyx()}, \hyperlink{a00019_adfb4e8d328a4cd1c7639082bef5841a9}{mfield\+\_\+y\+\_\+sen\+\_\+taskx()}, \hyperlink{a00060_source_l00464}{nov\+\_\+get\+\_\+serial\+\_\+number()}, \hyperlink{a00021_source_l00013}{R\+A\+N\+G\+E\+\_\+\+M\+A\+X\+\_\+8\+B\+I\+T}, \hyperlink{a00030_source_l00159}{serial\+\_\+init()}, \hyperlink{a00033_source_l00031}{sqtp\+\_\+t\+::serial\+\_\+number}, \hyperlink{a00032_source_l00030}{spi\+\_\+init()}, \hyperlink{a00067_source_l00027}{srv\+\_\+wdg\+\_\+init}, \hyperlink{a00067_source_l00028}{srv\+\_\+wdg\+\_\+kick}, \hyperlink{a00021_source_l00050}{S\+V\+\_\+\+C\+U\+R\+R\+E\+N\+\_\+\+O\+U\+T\+P\+U\+T\+\_\+\+L\+E\+V\+E\+L}, \hyperlink{a00073_source_l00023}{uv\+\_\+sen\+\_\+id}, \hyperlink{a00073_source_l00141}{uv\+\_\+sen\+\_\+notifyx()}, \hyperlink{a00073_source_l00069}{uv\+\_\+sen\+\_\+taskx()}, \hyperlink{a00037_source_l00135}{x\+\_\+init()}, \hyperlink{a00037_source_l00173}{x\+\_\+init\+\_\+task()}, \hyperlink{a00037_source_l00231}{x\+\_\+loop()}, and \hyperlink{a00037_source_l00196}{x\+\_\+start()}.


\begin{DoxyCode}
00081 \{
00090 \textcolor{comment}{// Configure PLL prescaler, PLL postscaler, PLL divisor}
00091 PLLFBD=63;                                           \textcolor{comment}{// M=65}
00092 CLKDIVbits.PLLPOST=0;                                \textcolor{comment}{// N2=2}
00093 CLKDIVbits.PLLPRE =0;                                \textcolor{comment}{// N1=3 //TODO: other option set to N1 = 2}
00094 \textcolor{comment}{// Initiate Clock Switch to FRC oscillator with PLL (NOSC=0b001)}
00095 \_\_builtin\_write\_OSCCONH(0x01);
00096 \_\_builtin\_write\_OSCCONL(OSCCON | 0x01);
00097 \textcolor{comment}{// Wait for Clock switch to occur}
00098 \textcolor{keywordflow}{while} (OSCCONbits.COSC!= 0b001);
00099 \textcolor{comment}{// Wait for PLL to lock}
00100 \textcolor{keywordflow}{while} (OSCCONbits.LOCK!= 1);
00101 
00102 
00103 
00104 
00105 \textcolor{preprocessor}{#if !defined(\_\_DEBUG)}
00106    \textcolor{comment}{// \_SWDTEN = 1;}
00107 \textcolor{preprocessor}{#endif}
00108 
00113     \hyperlink{a00067_a8a83a885a73db05d7faa34734d132644}{srv\_wdg\_init}();
00114     \hyperlink{a00067_a710d148845397582739d170341f3d3d9}{srv\_wdg\_kick}();
00115         
00116 
00117   
00118     \textcolor{comment}{// Init hwio}
00119     \hyperlink{a00058_a46e02bcdf3bfe45545879afb71919d47}{hwio\_configure\_init}();
00120     
00121 
00122 
00123     \{
00124     \hyperlink{a00058_a0af9eae455fbdf4e77def5bfffa109cb}{hwio\_execute\_gpio\_task}(\hyperlink{a00058_aae186cdf37c0783bf64b0aed3f1e6eda}{HWIO\_SV\_LED\_ON});
00125     \textcolor{keywordflow}{if}(RCONbits.WDTO)
00126         \textcolor{keywordflow}{while}(1);
00127 \textcolor{preprocessor}{     #if (DEVICE == AQ0X\_V1)}
00128     \hyperlink{a00072_a59a9f6be4562c327cbfb4f7e8e18f08b}{Uint16} sv\_current\_level = \hyperlink{a00058_a5770775aca185380868838e69ec20215}{hwio\_get\_analog}(ANA\_INDEX\_SV\_CURRENT);
00129     \hyperlink{a00072_af84840501dec18061d18a68c162a8fa2}{Uint8}  cc = 1;
00130     \hyperlink{a00072_a59a9f6be4562c327cbfb4f7e8e18f08b}{Uint16} single\_sensor\_output =  \hyperlink{a00021_a648a6327bd26d3d2f537bbea230c6ffb}{SV\_CURREN\_OUTPUT\_LEVEL};
00131 
00132 
00133 
00134    
00135             \textcolor{keywordflow}{while}(1)\{
00138                  \textcolor{keywordflow}{if}(cc++ < \hyperlink{a00021_ae0c75a1cb44e5d3f00ec7c9e40acfda8}{RANGE\_MAX\_8BIT})\{
00139                      \textcolor{keywordflow}{if}(sv\_current\_level <= single\_sensor\_output)\{
00140                          \hyperlink{a00060_a76ac5f917f5308dcd83de0d7c94559fb}{data\_non\_volatile}.device\_data.installation.device\_address = cc;
00141                          \textcolor{keywordflow}{break};
00142                      \}\textcolor{keywordflow}{else}
00143                         single\_sensor\_output +=\hyperlink{a00021_a648a6327bd26d3d2f537bbea230c6ffb}{SV\_CURREN\_OUTPUT\_LEVEL};
00144                  \}
00145               \hyperlink{a00067_a710d148845397582739d170341f3d3d9}{srv\_wdg\_kick}();
00146         
00147             \}
00148 \textcolor{preprocessor}{    #endif}
00149 
00150     \hyperlink{a00058_a0af9eae455fbdf4e77def5bfffa109cb}{hwio\_execute\_gpio\_task}(\hyperlink{a00058_a8fe69ad7e533d2e88cec53c22a56f8fb}{HWIO\_SV\_LED\_OFF});
00151     \}
00152 
00153        
00154  
00155     \textcolor{comment}{// Init serial port communication}
00156     \hyperlink{a00031_ad2b461e9e9044364a28a61cfadcacdd8}{serial\_init}();
00157    
00158 
00159     \hyperlink{a00013_ae909944aa85ae98323073c628be541aa}{spi\_init}();
00160 
00161 
00162   
00163     \hyperlink{a00048_a4e1e8b365cce7a6d497671681eb5823c}{sqtp\_info}.\hyperlink{a00033_a728c5fe7bc16e168a8f93fba18ee5561}{serial\_number} = 0;
00164     \textcolor{comment}{// Initialize SQPT production info}
00165     \hyperlink{a00048_a4e1e8b365cce7a6d497671681eb5823c}{sqtp\_info}.\hyperlink{a00033_a728c5fe7bc16e168a8f93fba18ee5561}{serial\_number} = \hyperlink{a00029_a86b863ea185628aff5a00b4defbbb6e1}{nov\_get\_serial\_number}();
00166     \textcolor{comment}{//TODO:what to do if empty}
00167  
00168     \textcolor{comment}{// Init operating system internal structures}
00169     \hyperlink{a00036_a05f27d3148e368ee84a448f3c4b083dd}{x\_init}();        
00170     
00171     
00172 
00173     \textcolor{comment}{// Init modules}
00174     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00021_a1d182ae18a9176c2a1e28cc654dc0e43}{algorithm\_taskx},\hyperlink{a00021_a93269cdec3e21934aa9395440a2de605}{algorithm\_notifyx},&
      \hyperlink{a00021_aff3e3d622fcd96787628167d3c1856f9}{algorithm\_id},\textcolor{stringliteral}{"algorithm"});
00175     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00017_a24529100c87dfc257e9b56f7f0bcfa78}{ir\_sen\_taskx},\hyperlink{a00017_a36c6c2cdf9aa5844371e742330789dad}{ir\_sen\_notifyx},&
      \hyperlink{a00017_a624782f67b3870f0dde83528770ef5fc}{ir\_sen\_id},\textcolor{stringliteral}{"ir"});
00176     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00020_ab4e931568892f0b46a2571d3c480f5c8}{uv\_sen\_taskx},\hyperlink{a00020_ae2617634df4d3055161f7fb1f148f6da}{uv\_sen\_notifyx},&
      \hyperlink{a00020_afd789f3f9ea182d28d4f16db0d8d5652}{uv\_sen\_id},\textcolor{stringliteral}{"uv"});
00177 \textcolor{preprocessor}{    #if(DEVICE == AQ0X\_V1)}
00178     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00018_ae9aa2f8b8e90a92755efbcd161c67bc0}{light\_sen\_taskx},\hyperlink{a00018_a317b03892739257278fd51ab8003962d}{light\_sen\_notifyx},&
      \hyperlink{a00018_a757e7771170ace1d9f8519bd318ec64a}{light\_sen\_id},\textcolor{stringliteral}{"light"});
00179 \textcolor{preprocessor}{    #endif}
00180     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00019_a72e9235043dc4a8469143a6eb48bf117}{mfield\_x\_sen\_taskx},
      \hyperlink{a00019_ac28a2b5f3fa92c0593446e15a63a501c}{mfield\_x\_sen\_notifyx},&\hyperlink{a00019_a19a33e680bf19d1aed76750132ed8b64}{mfield\_x\_sen\_id},\textcolor{stringliteral}{"mfield\_x"});
00181      
00182 \textcolor{preprocessor}{#ifdef MFIELD\_Y}
00183     \hyperlink{a00036_a1e79db5ed3ab326586129eb4d7b63d46}{x\_init\_task}(\hyperlink{a00019_adfb4e8d328a4cd1c7639082bef5841a9}{mfield\_y\_sen\_taskx},
      \hyperlink{a00019_a80b82366f7d22e925f279d20328f05c8}{mfield\_y\_sen\_notifyx},&\hyperlink{a00019_a99c4ad3cf8b9ce2b67351d6edf48f937}{mfield\_y\_sen\_id},\textcolor{stringliteral}{"mfield\_y"});
00184 \textcolor{preprocessor}{#endif}
00185    
00186    
00187     \textcolor{comment}{// Send startup notifications to modules}
00188     \hyperlink{a00036_aea907663ecaf77bacfb9f0bfdc11f900}{x\_start}();        
00189 
00190      
00198     \hyperlink{a00067_a710d148845397582739d170341f3d3d9}{srv\_wdg\_kick}();
00199 
00200 
00201     \textcolor{keywordflow}{while} (1)             
00202     \{
00203          
00204         \textcolor{comment}{// Execute operating system loop}
00205         \textcolor{comment}{// The operating system takes care over watchdog bites}
00206         \hyperlink{a00036_a4bb7a012be733e061c913e7b98df642b}{x\_loop}();
00207 
00208     \}
00209     \textcolor{keywordflow}{return} 0;             
00210 \}
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/dca/a00048_a840291bc02cba5474a4cb46a9b9566fe_cgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{a00048_a4e1e8b365cce7a6d497671681eb5823c}{\index{main.\+c@{main.\+c}!sqtp\+\_\+info@{sqtp\+\_\+info}}
\index{sqtp\+\_\+info@{sqtp\+\_\+info}!main.\+c@{main.\+c}}
\subsubsection[{sqtp\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}{\bf sqtp\+\_\+t} sqtp\+\_\+info}}\label{a00048_a4e1e8b365cce7a6d497671681eb5823c}


Oscilator setting Run this project using an internal F\+R\+C. 

Disable Code Protection Select P\+G\+D/\+P\+G\+C as debugging channel Communicate on P\+G\+E\+C2 and P\+G\+E\+D2 Enable M\+C\+L\+R reset pin and turn off the power-\/up timers. Disable memory security 

Definition at line \hyperlink{a00048_source_l00068}{68} of file \hyperlink{a00048_source}{main.\+c}.

